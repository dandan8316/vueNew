<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.thymeleaf.org ">

<head>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <title>Charge confirm</title>
</head>
<style>
    /* CSS Reset*/
    html {
        font-size: 20px;
        /* 20÷16=125% min-font-size:12px bug*/
    }

    @media only screen and (max-width: 1080px),
    only screen and (max-device-width: 1080px) {

        html,
        body {
            font-size: 57.599999999999994px;
        }
    }

    @media only screen and (max-width: 960px),
    only screen and (max-device-width: 960px) {

        html,
        body {
            font-size: 51.2px;
        }
    }

    @media only screen and (max-width: 800px),
    only screen and (max-device-width: 800px) {

        html,
        body {
            font-size: 42.666666666666664px;
        }
    }

    @media only screen and (max-width: 720px),
    only screen and (max-device-width: 720px) {

        html,
        body {
            font-size: 38.4px;
        }
    }

    @media only screen and (max-width: 640px),
    only screen and (max-device-width: 640px) {

        html,
        body {
            font-size: 34.13333333333333px;
        }
    }

    @media only screen and (max-width: 600px),
    only screen and (max-device-width: 600px) {

        html,
        body {
            font-size: 32px;
        }
    }

    @media only screen and (max-width: 540px),
    only screen and (max-device-width: 540px) {

        html,
        body {
            font-size: 28.799999999999997px;
        }
    }

    @media only screen and (max-width: 480px),
    only screen and (max-device-width: 480px) {

        html,
        body {
            font-size: 25.6px;
        }
    }

    @media only screen and (max-width: 414px),
    only screen and (max-device-width: 414px) {

        html,
        body {
            font-size: 22.080000000000002px;
        }
    }

    @media only screen and (max-width: 400px),
    only screen and (max-device-width: 400px) {

        html,
        body {
            font-size: 21.333333333333332px;
        }
    }

    @media only screen and (max-width: 375px),
    only screen and (max-device-width: 375px) {

        html,
        body {
            font-size: 20px;
        }
    }

    @media only screen and (max-width: 360px),
    only screen and (max-device-width: 360px) {

        html,
        body {
            font-size: 19.2px;
        }
    }

    @media only screen and (max-width: 320px),
    only screen and (max-device-width: 320px) {

        html,
        body {
            font-size: 17.066666666666666px;
        }
    }

    @media only screen and (max-width: 240px),
    only screen and (max-device-width: 240px) {

        html,
        body {
            font-size: 12.8px;
        }
    }

    body,
    div,
    span,
    applet,
    object,
    iframe,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    blockquote,
    pre,
    a,
    abbr,
    acronym,
    address,
    big,
    cite,
    code,
    del,
    dfn,
    em,
    img,
    ins,
    kbd,
    q,
    s,
    samp,
    small,
    strike,
    strong,
    tt,
    var,
    b,
    u,
    i,
    center,
    dl,
    dt,
    dd,
    ol,
    ul,
    li,
    fieldset,
    form,
    label,
    legend,
    table,
    caption,
    tbody,
    tfoot,
    thead,
    tr,
    th,
    td,
    article,
    aside,
    canvas,
    details,
    embed,
    figure,
    figcaption,
    footer,
    header,
    hgroup,
    menu,
    nav,
    output,
    ruby,
    section,
    summary,
    time,
    mark,
    audio,
    video {
        margin: 0;
        padding: 0;
        border: 0;
        /* vertical-align: baseline; */
        font-family: 'Microsoft YaHei';
    }

    body {
        font-family: 'Microsoft YaHei';
        color: #333;
        width: 100%;
    }

    em {
        font-style: normal;
    }

    li {
        list-style: none;
    }

    a {
        text-decoration: none;
        outline: 0;
        color: #333;
    }

    img {
        border: none;
        vertical-align: middle;
    }

    table {
        border-collapse: collapse;
    }

    input,
    textarea {
        font-family: 'Microsoft YaHei';
        padding: 0;
        background: none;
    }

    textarea {
        resize: none;
        overflow: auto;
    }

    textarea:focus {
        outline: none;
    }

    input:focus {
        outline: none;
    }

    .clear {
        zoom: 1;
    }

    .clear:after {
        content: '';
        display: block;
        clear: both;
    }

    html,
    body {
        width: 100vw;
        height: 100vh;
        background-color: #f5f5f5;
    }

    /* 代码的样式 */
    /* 1，导航栏的样式 */
    .nav {
        width: 100vw;
        height: 2.2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #f5f5f5;
        background-color: #fff;
    }

    .nav .left {
        font-size: 0.85rem;
        margin-left: 0.5rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(51, 51, 51, 1);
    }

    .nav .center {
        display: inline-block;
        text-align: center;
        font-size: 0.85rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(51, 51, 51, 1);
    }

    .nav .right {
        /* width: 3.35rem; */
        height: 0.4rem;
    }

    /* mainnav */
    .mainnav {
        width: 100vw;
        height: 2.2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #f5f5f5;
        background-color: #fff;
    }

    .mainnav .left {
        font-size: 0.85rem;
        font-family: PingFang-SC-Bold;
        font-weight: bold;
        color: rgba(255, 96, 0, 1);
        margin-left: 0.5rem;
    }

    .mainnav .right {
        font-size: 0.85rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(51, 51, 51, 1);
        margin-right: 0.5rem;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .mainnav .right span {
        margin-right: 0.1rem;
        display: flex;
        justify-content: center;
        align-content: center;
    }

    .mainnav .right span img {
        width: 0.5rem;
        height: 0.5rem;
    }

    .mainnav .right .m {
        font-size: 0.55rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(255, 7, 7, 1);
    }

    .mainnav .right .s {
        font-size: 0.55rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(255, 7, 7, 1);
    }

    /* 充值的数据 */
    .paydes {
        width: 100%;
        height: auto;
        display: flex;
        justify-content: flex-start;
        flex-wrap: wrap;
        background-color: #fff;
    }

    .paydes .top {
        width: 100%;
        display: flex;
        justify-content: flex-start;
        line-height: 0.85rem;
        align-items: center;
        margin-left: 0.5rem;
    }

    .paydes span {
        font-size: 0.65rem;
        font-family: PingFang-SC-Bold;
        font-weight: bold;
        color: rgba(51, 51, 51, 1);
    }

    .paydes .top .topimg {
        width: 0.5rem;
        height: 0.5rem;
        margin-left: 0.95rem;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 0.1rem;
    }

    .paydes .top img {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
    }

    .paydes .center {
        width: 100%;
        line-height: 0.85rem;
        margin-left: 0.5rem;
    }

    .paydes .bottom {
        width: 100%;
        line-height: 0.85rem;
        margin-left: 0.5rem;
    }

    /* 底部的提交的按钮 */
    .footer {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 2.45rem;
        background-color: #fff;
        display: flex;
        justify-content: flex-end;
        align-items: center;
    }

    .footer .right {
        width: 65%;
        height: 100%;
        display: flex;
        justify-content: flex-end;
        align-items: center;
    }

    .footer .right .rightsum {
        font-size: 0.65rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(102, 102, 102, 1);
    }

    .footer .right .rightprice {
        font-size: 0.65rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(255, 96, 0, 1);
    }

    .footer .right .rightprice2 {
        font-size: 0.65rem;
        font-family: PingFang-SC-Medium;
        font-weight: 500;
        color: rgba(255, 96, 0, 1);
        margin-right: 0.5rem;
    }

    .footer .rightcommit {
        width: 5.65rem;
        height: 2.45rem;
        background-color: #333333;
        box-shadow: 0px -1px 0px 0px rgba(245, 245, 245, 1);
        position: relative;
    }

    /* 表单的 */
    .form {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        right: 0;

    }
    /* 表单的按钮的层级最高 */

    .form button {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        right: 0;
        display: inline-block;
        z-index: 900;
        opacity: 0;
    }

/* 层级第二 */
    .cover {
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        right: 0;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }

/* 默认的层级最低 */
    #covercancel {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        right: 0;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
        opacity: 0;
    }

    #backgocancel{
        color: #fff;
        line-height: 2.5rem;
    }
    .cover{

        color: #fff;
        opacity: 1;

    }
</style>

<body>
    <!-- 1，导航栏的样式 -->
    <div class="nav">
        <a href="#" id="backgo" onclick="back()"><span class="left">&lt;</span></a>
        <span class="center" th:text="#{pay.order.confirm.title}">确认订单</span>
        <span class="right"></span>
    </div>
    <!-- mainnav的样式 -->
    <div class="mainnav">
        <span class="left" th:text="#{pay.order.remain.time}">剩余支付时间:</span>
        <div class="right">
            <span>
                <img src="/pay/clock.png" alt="" />
            </span>
            <!-- <span class="m" id="intshi">1</span>
        <span class="m" id="intge">9</span>
        <span>分</span> -->
            <span class="s" id="intshi2">5</span>
            <span class="s" id="intge2">9</span>
            <span th:text="#{pay.order.second}">秒</span>
        </div>
    </div>
    <!-- 充值的数据 -->
    <div class="paydes">
        <div class="top">
            <span th:text="*{buyProdInfo}">金币值:</span>
            <span th:if="${coins gt 0}">
                <nobr>
                <span class="topimg"><img src="/pay/price.png" alt="" /></span>
                <span id="coins" th:text="*{coins}">7203</span>
                </nobr>
            </span>
        </div>
        <div class="center">
            <span th:text="#{pay.order.buy.price}">价格:</span>
            <span>￥</span>
            <span id="amount" th:text="*{amount/100}">98</span>
        </div>
        <div class="bottom">
            <span th:text="#{pay.order.create.time}">创建时间:</span>
            <span id="createDate">2019.0.06</span>
        </div>
    </div>
    <!-- 提交订单 -->
    <div class="footer">
        <div class="right">
            <span class="rightsum" th:text="#{pay.order.total.amount}">合计金额:</span>
            <span class="rightprice">￥</span>
            <span class="rightprice2" id="amount2" th:text="*{amount/100}">98</span>
        </div>
        <div class="rightcommit">
            <!-- from按钮 -->
            <form action="/pay/apid/stripePay/charge/" method="POST" class="form">
                <!-- <input type="hidden" name="baseUrl" th:text="${baseUrl}"  id="localur" /> -->
                <input type="hidden" name="out_trade_no" th:value="*{out_trade_no}" />
                <input type="hidden" name="order_no" th:value="*{order_no}" />
                <input type="hidden" name="coins" th:value="*{coins}" />
                <input type="hidden" name="createDate" id="createDatePay" th:value="*{createDate}" />
                <script th:inline="javascript" src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                    th:attrappend="data-key=*{publishable_key},data-amount=*{amount},data-currency=*{currency},data-image=*{image},data-name=*{name},data-description=*{descs}"
                    data-locale="auto">
                </script>
                <!--<script th:inline="javascript" src="https://checkout.stripe.com/checkout.js" class="stripe-button"-->
                <!--id="stripe-pay" data-key="" data-currency="" data-name="Stripe.com"  data-description="Example charge"-->
                <!--data-locale="auto"></script>-->
            </form>

            <div class="cover" th:text="#{pay.order.buy.now}">
                立即支付
            </div>
            <div id="covercancel" >
                <a href="" id="backgocancel" >
                    <span th:text="#{pay.order.cancel}" onclick="back()">取消订单</span>
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcss.com/jquery/1.12.3/jquery.min.js"></script>

    <script th:inline="javascript">
            var baseUrl = [[${baseUrl}]];
            console.log(baseUrl);
    </script>

    <script>
        function back() {
            window.history.back();
        }
        //   返回上一级

        $(function () {
            var url=baseUrl+'mygold?t=1';
            //$('#backgo').attr('href',url);
            $('#backgocancel').attr('href',url);
            $('#covercancel').attr('opacity',0);
            countDown();
            console.log(document.referrer);
        })

        function countDown() {
            var lala = $('#createDatePay').val();
            var lala1 = parseInt(lala)
            var he = formatDateTime(lala1);
            document.getElementById('createDate').innerHTML = he;
            newYear_time()
        }

        function formatDateTime(inputTime) {
            var date = new Date(inputTime);
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            m = m < 10 ? ('0' + m) : m;
            var d = date.getDate();
            d = d < 10 ? ('0' + d) : d;
            var h = date.getHours();
            h = h < 10 ? ('0' + h) : h;
            var minute = date.getMinutes();
            var second = date.getSeconds();
            minute = minute < 10 ? ('0' + minute) : minute;
            second = second < 10 ? ('0' + second) : second;
            return y + '-' + m + '-' + d + ' ' + h + ':' + minute + ':' + second;
        }

        function prepareOrder() {
            // 获取订单
            // 金币
            document.getElementById('coins').innerHTML = window.localStorage.getItem('coins')
            // 购买价格
            document.getElementById('amount').innerHTML = window.localStorage.getItem('amount') / 100
            // 合计金额
            document.getElementById('amount2').innerHTML = window.localStorage.getItem('amount') / 100



            var lala = window.localStorage.getItem('createDate')
            var lala1 = parseInt(lala)
            var he = formatDateTime(lala1)
            document.getElementById('createDate').innerHTML = he
            //stripe参数的自定义的
            document.getElementById('stripe-pay').setAttribute('data-name', window.localStorage.getItem('name'))
            document.getElementById('stripe-pay').setAttribute('data-image', window.localStorage.getItem('image'))
            document.getElementById('stripe-pay').setAttribute('data-amount', window.localStorage.getItem(
                'amount') / 100)
            var dataKey = window.localStorage.getItem('publishable_key');
            var currency = window.localStorage.getItem('currency');
            var descs = window.localStorage.getItem('descs');
            // console.log('dataKey=' + dataKey + ' currency=' + currency + ' descs=' + descs);

            var pay = $('#stripe-pay');
            // console.log(pay);
            pay.attr('data-currency', currency);
            pay.attr('data-key', dataKey);
            pay.attr('data-description', descs);
            pay.attr('data-name', window.localStorage.getItem('name'))
            pay.attr('data-image', window.localStorage.getItem('image'))
            pay.attr('data-amount', window.localStorage.getItem(
                'amount') / 100);

            // document.getElementById('stripe-pay').setAttribute('data-locale', window.localStorage.getItem(
            //     'createDate'))
            // newYear_time()
        }

        function newYear_time() {
            //1,设定当前时间
            var time_start = new Date().getTime()
            // console.log(time_start);
            //2,设定目标时间,默认是1分钟
            // 获取时间
            var lala = $('#createDatePay').val();
            // console.log('----newYear_time=' + lala)
            // 转换成number
            var lala1 = parseInt(lala);
            // 起始时间

            var time_end = lala1 + 1 * 60 * 1000 //设定目标时间

            // 计算时间差
            var time_distance = time_end - time_start
            // console.log(time_distance)
            // 天
            var int_day = Math.floor(time_distance / 86400000)
            time_distance -= int_day * 86400000
            // 时
            var int_hour = Math.floor(time_distance / 3600000)
            time_distance -= int_hour * 3600000
            // 分
            var int_minute = Math.floor(time_distance / 60000)
            time_distance -= int_minute * 60000
            // 秒
            var int_second = Math.floor(time_distance / 1000)
            // 时分秒为单数时、前面加零
            if (int_day < 10) {
                int_day = '0' + int_day
            }
            if (int_hour < 10) {
                int_hour = '0' + int_hour
            }
            if (int_minute < 10) {
                int_minute = '0' + int_minute
            }
            if (int_second < 10) {
                int_second = '0' + int_second
            }

            int_day = parseInt(int_day)
            int_hour = parseInt(int_hour)
            int_minute = parseInt(int_minute)
            int_second = parseInt(int_second)

            int_day_shi = parseInt(int_day / 10)
            int_day_ge = int_day % 10

            int_hour_shi = parseInt(int_hour / 10)
            int_hour_ge = int_hour % 10

            int_minute_shi = parseInt(int_minute / 10)
            int_minute_ge = int_minute % 10

            int_second_shi = parseInt(int_second / 10)
            int_second_ge = int_second % 10

            $('#intshi').html(int_minute_shi)
            $('#intge').html(int_minute_ge)
            $('#intshi2').html(int_second_shi)
            $('#intge2').html(int_second_ge)

            // $('.content_1 .int_day_shi').html(int_day_shi)
            // $('.content_1 .int_day_ge').html(int_day_ge)

            // $('.content_1 .int_hour_shi').html(int_hour_shi)
            // $('.content_1 .int_hour_ge').html(int_hour_ge)


            // 设置定时器
            var clearclock = setTimeout('newYear_time()', 1000)

            if (time_end - time_start < 1000) {
                clearInterval(clearclock)
                console.log('订单已经结束了')
                $('.cover').css('opacity',"0"); //隐藏
                $('.form button').css('z-index',"1"); //隐藏
                $('.form button').css('display',"none"); //隐藏
                $('.cover').hide(); //隐藏
                $('#covercancel').show(); //显示
                $("#covercancel").css("z-index", "999");
                $("#covercancel").css("opacity", "1");
                $('#intshi').html(0)
                $('#intge').html(0)
                $('#intshi2').html(0)
                $('#intge2').html(0)
            }
        }

    </script>
</body>

</html>
